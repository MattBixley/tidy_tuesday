[
["himalayan-peaks.html", "Himalaya 22-09-2020 1 Himalayan Peaks 1.1 Data Inspection 1.2 Everest Only", " Himalaya 22-09-2020 Matt Bixley 22/09/2020 1 Himalayan Peaks Alex Cookson 1.1 Data Inspection Shows a list of 3 data sets, peaks, members and expeditions tt_data %&gt;% glimpse() 1.2 Everest Only exped &lt;- tt_data$expeditions %&gt;% filter(peak_name == &quot;Everest&quot;) members &lt;- tt_data$members %&gt;% filter(peak_name == &quot;Everest&quot;) How popular is Everest, to climb. sum_exped &lt;- exped %&gt;% group_by(year) %&gt;% summarise(Expeditions = n(), Climbers = sum(members + hired_staff), Deaths = sum(member_deaths + hired_staff_deaths)) %&gt;% ungroup() %&gt;% complete(year = 1920:2020, fill = list(Expeditions = 0, Climbers = 0, Deaths = 0)) %&gt;% pivot_longer(Expeditions:Deaths,names_to = &quot;category&quot;, values_to = &quot;number&quot;) ## `summarise()` ungrouping output (override with `.groups` argument) rate_exped &lt;- exped %&gt;% group_by(year) %&gt;% summarise(Expeditions = n(), Climbers = sum(members + hired_staff), Deaths = sum(member_deaths + hired_staff_deaths)) %&gt;% ungroup() %&gt;% mutate(climbers_exped = Climbers/Expeditions, deaths_exped = Deaths/Expeditions, deaths_climbers = Deaths/Climbers) %&gt;% complete(year = 1920:2020, fill = list(climbers_exped = 0, deaths_exped = 0, deaths_climbers = 0)) %&gt;% select(year,climbers_exped:deaths_climbers) %&gt;% pivot_longer(climbers_exped:deaths_climbers,names_to = &quot;category&quot;, values_to = &quot;rate&quot;) ## `summarise()` ungrouping output (override with `.groups` argument) sum_exped %&gt;% ggplot(aes(year, number, fill = year)) + geom_col() + facet_wrap( ~ category, scales = &quot;free_y&quot;) + scale_x_continuous(breaks = seq(1920, 2020, 10)) + scale_y_continuous(labels = label_comma()) + scale_fill_fish(option = &quot;Pseudocheilinus_tetrataenia&quot;, direction = 1) + labs( title = &quot;Everest&#39;s popularity has soared since the 1980s&quot;, caption = &quot;Source: The Himalayan Database&quot;, x = &quot;&quot;,y = &quot;&quot; ) + theme( legend.position = &quot;none&quot;, text = element_text(family = &quot;Bahnschrift&quot;), axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), panel.grid.minor = element_blank(), strip.text = element_text(size = 12, colour = &quot;black&quot;), strip.background = element_blank() ) new_labels &lt;- c(&quot;climbers_exped&quot; = &quot;Climbers/Expedition&quot;, &quot;deaths_climbers&quot; = &quot;Deaths/Climber&quot;, &quot;deaths_exped&quot; = &quot;Deaths/Expedition&quot;) rate_exped %&gt;% ggplot(aes(year, rate, fill = year)) + geom_col() + facet_wrap( ~ category, scales = &quot;free_y&quot;, labeller = labeller(category = new_labels)) + scale_x_continuous(breaks = seq(1920, 2020, 10)) + scale_y_continuous(labels = label_comma()) + scale_fill_fish(option = &quot;Pseudocheilinus_tetrataenia&quot;, direction = 1) + labs( title = &quot;Everest&#39;s popularity has soared since the 1980s&quot;, subtitle = &quot;But Death rates have decreased, both on a per climber and per expedition basis&quot;, caption = &quot;Source: The Himalayan Database&quot;, x = &quot;&quot;,y = &quot;&quot; ) + theme( legend.position = &quot;none&quot;, text = element_text(family = &quot;Bahnschrift&quot;), axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), panel.grid.minor = element_blank(), strip.text = element_text(size = 12, colour = &quot;black&quot;), strip.background = element_blank() ) library(ggtext) expeditions &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-22/expeditions.csv&#39;) ## Parsed with column specification: ## cols( ## expedition_id = col_character(), ## peak_id = col_character(), ## peak_name = col_character(), ## year = col_double(), ## season = col_character(), ## basecamp_date = col_date(format = &quot;&quot;), ## highpoint_date = col_date(format = &quot;&quot;), ## termination_date = col_date(format = &quot;&quot;), ## termination_reason = col_character(), ## highpoint_metres = col_double(), ## members = col_double(), ## member_deaths = col_double(), ## hired_staff = col_double(), ## hired_staff_deaths = col_double(), ## oxygen_used = col_logical(), ## trekking_agency = col_character() ## ) year_range &lt;- 2000:2019 top_n_freq_peaks &lt;- expeditions %&gt;% filter(year %in% year_range) %&gt;% group_by(peak_name) %&gt;% summarise(total_expeditions = n()) %&gt;% top_n(10, total_expeditions) %&gt;% arrange(desc(total_expeditions)) %&gt;% mutate(peak_name = reorder(peak_name, rev(total_expeditions))) ## `summarise()` ungrouping output (override with `.groups` argument) expeditions_daily &lt;- expeditions %&gt;% filter(peak_name %in% top_n_freq_peaks$peak_name &amp; !is.na(basecamp_date) &amp; year %in% year_range) %&gt;% mutate(day = lubridate::yday(basecamp_date), success = if_else(str_detect(termination_reason, &quot;Success&quot;), TRUE, FALSE)) %&gt;% group_by(peak_name, day, success) %&gt;% summarise(num_expeditions = n()) %&gt;% mutate(num_expeditions = if_else(success, num_expeditions, -num_expeditions)) ## `summarise()` regrouping output by &#39;peak_name&#39;, &#39;day&#39; (override with `.groups` argument) # Use this to fill missing days all_days &lt;- expand_grid(peak_name = top_n_freq_peaks$peak_name, day = c(1:365), success = c(TRUE, FALSE)) expeditions_daily_all &lt;- all_days %&gt;% left_join(expeditions_daily) %&gt;% mutate(num_expeditions = replace_na(num_expeditions, 0), peak_name = factor(peak_name, levels = top_n_freq_peaks$peak_name, ordered = TRUE)) ## Joining, by = c(&quot;peak_name&quot;, &quot;day&quot;, &quot;success&quot;) # Plot expeditions_daily_all %&gt;% group_by(peak_name) %&gt;% ggplot(aes(x = day, y = num_expeditions)) + geom_area(aes(fill = success), alpha = 1) + scale_x_continuous(breaks = seq(15, 365, 30), labels = function(x) lubridate::month(as.Date(x, origin = &#39;2019-01-01&#39;), label = TRUE)) + scale_fill_manual(labels = c(&quot;terminated expeditions&quot;, &quot;successful expeditions&quot;), values = c(&quot;#1a1a1a&quot;, &quot;#b5b4bf&quot;)) + facet_grid(rows = vars(peak_name), switch = &quot;y&quot;) + labs(title = &quot;Expeditions are most frequent around April and October for the top 10 travelled peaks 2000-2019&quot;, caption = &quot;Visualisation: Michael Chan â€¢ Data: The Himalayan Database&quot;) + theme_minimal() + theme(plot.background = element_rect(color = &quot;#818aa1&quot;, fill = &quot;#818aa1&quot;), plot.title = element_text(size = 16, face = &quot;bold&quot;, color = &quot;grey80&quot;), axis.title = element_blank(), axis.text.x = element_text(size = 12, colour = &quot;grey80&quot;), axis.text.y = element_blank(), strip.text.y.left = element_text(size = 16, angle = 0, vjust = 0.4, colour = &quot;grey80&quot;), legend.position = &quot;bottom&quot;, legend.title = element_blank(), legend.text = element_text(size = 10), panel.grid = element_blank(), panel.spacing.y = unit(-8, &quot;lines&quot;)) + guides(fill = guide_legend(ncol = 1, reverse = TRUE)) "]
]
